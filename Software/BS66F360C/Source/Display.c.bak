
#include	"Display.h"

#define		C_LED_NUM3_ADD				3
#define		C_LED_NUM2_ADD				2
#define		C_LED_NUM1_ADD				1
#define		C_LED_KEY_ADD					0

#define 	C_SEG_A	 					0x01
#define 	C_SEG_B	 					0x02
#define 	C_SEG_C	 					0x04
#define 	C_SEG_D	 					0x08
#define 	C_SEG_E	 					0x10
#define 	C_SEG_F	 					0x20
#define 	C_SEG_G	 					0x40
#define 	C_SEG_DP	 				0x80

#define 	C_NUM0	 					(C_SEG_A|C_SEG_B|C_SEG_C|C_SEG_D|C_SEG_E|C_SEG_F)
#define 	C_NUM1	 					(C_SEG_B|C_SEG_C)
#define 	C_NUM2	 					(C_SEG_A|C_SEG_B|C_SEG_D|C_SEG_E|C_SEG_G)
#define 	C_NUM3	 					(C_SEG_A|C_SEG_B|C_SEG_C|C_SEG_D|C_SEG_G)
#define 	C_NUM4	 					(C_SEG_B|C_SEG_C|C_SEG_F|C_SEG_G)
#define 	C_NUM5	 					(C_SEG_A|C_SEG_C|C_SEG_D|C_SEG_F|C_SEG_G)
#define 	C_NUM6	 					(C_SEG_A|C_SEG_C|C_SEG_D|C_SEG_E|C_SEG_F|C_SEG_G)
#define 	C_NUM7	 					(C_SEG_A|C_SEG_B|C_SEG_C)
#define 	C_NUM8	 					(C_SEG_A|C_SEG_B|C_SEG_C|C_SEG_D|C_SEG_E|C_SEG_F|C_SEG_G)
#define 	C_NUM9	 					(C_SEG_A|C_SEG_B|C_SEG_C|C_SEG_D|C_SEG_F|C_SEG_G)

const unsigned char  R_NumTable[10]={C_NUM0,C_NUM1,C_NUM2,C_NUM3,C_NUM4,C_NUM5,C_NUM6,C_NUM7,C_NUM8,C_NUM9};

void Dis_SetDisBufferAll(unsigned char gubv_setData)
{
	unsigned char n;
	for(n=0;n<4;n++)
	{
		gu8v_DisplayBuf[n]=gubv_setData;
	}
}

void Display_Task (void)
{	
	unsigned char disNum,r_Num3,r_Num2,r_Num1,length;

	Dis_SetDisBufferAll(0x00);
	switch(gu8v_WorkMode)
	{
		case C_POWER_ON_MODE:
			Dis_SetDisBufferAll(0xFF);
		break;
		case C_WORK_OFF_MODE:
			if(!gubv_12vOff&&!gubv_BalLowStatus)
			{
				if(gubv_PowerStatus)
				{
					gu8v_DisplayBuf[C_LED_NUM2_ADD] =  R_NumTable[0];
				}
			}
			else
			{
				if(gu8v_BeepType==C_BP_ERROR&&(!F_LowVoltage))				
				{
					gu8v_DisplayBuf[C_LED_KEY_ADD] |= C_SEG_A;
				}
			}
		break;
		case  C_WORK_ON_MODE :
		
				if(gubv_StaticMode)
				{
					gu8v_DisplayBuf[C_LED_NUM1_ADD] =  C_SEG_G;
					gu8v_DisplayBuf[C_LED_NUM3_ADD] =  C_SEG_G;
					gu8v_DisplayBuf[C_LED_NUM2_ADD] =  C_SEG_G;
				}
				else
				{
					switch(gu8v_PressureMode)
					{
						case 1:
							disNum = 50;
						break;
						case 2:
							disNum = 70;
						break;
						case 3:
							disNum = 90;
						break;
						case 4:
							disNum = 110;
						break;
						case 5:
							disNum = 130;
						break;
						default:
							disNum = 30;
						break;
					}
					r_Num3 = disNum/100;
					r_Num2 = disNum%100;
					r_Num1 =  r_Num2%10;
					r_Num2 =  r_Num2/10;
					gu8v_DisplayBuf[C_LED_NUM1_ADD] =  R_NumTable[r_Num1];
					if(r_Num3)
					{
						gu8v_DisplayBuf[C_LED_NUM3_ADD] =  R_NumTable[r_Num3];
						gu8v_DisplayBuf[C_LED_NUM2_ADD] =  R_NumTable[r_Num2];
					}
					else
					{
						if(r_Num2)
						{
							gu8v_DisplayBuf[C_LED_NUM2_ADD] =  R_NumTable[r_Num2];
						}
					}
				}
				if(gubv_StaticMode)				gu8v_DisplayBuf[C_LED_KEY_ADD] |= C_SEG_B;
				if(gubv_AutoMode)				gu8v_DisplayBuf[C_LED_KEY_ADD] |= C_SEG_C;
				if(gubv_QiBeiMode)				gu8v_DisplayBuf[C_LED_KEY_ADD] |= C_SEG_D;
				if(gubv_DcfLeftFanShenMode)		gu8v_DisplayBuf[C_LED_KEY_ADD] |= C_SEG_E;
				if(gubv_DcfRightFanShenMode)	gu8v_DisplayBuf[C_LED_KEY_ADD] |= C_SEG_F;
				if(gubv_TaituiMode)				gu8v_DisplayBuf[C_LED_KEY_ADD] |= C_SEG_G;
				if(gubv_RfCopyMode)
				{
					switch(gu8v_RfIdCopyLedDisStep)
					{
						case 0:
							gu8v_DisplayBuf[C_LED_NUM3_ADD] |= C_SEG_DP;//led9 12M
						break;
						case 1:
							gu8v_DisplayBuf[C_LED_NUM2_ADD] |= C_SEG_DP;//led10 18M
						break;
						case 2:
							gu8v_DisplayBuf[C_LED_NUM1_ADD] |= C_SEG_DP;//led11 24M
						break;
					}
					if(gubv_500mS)
					{
						gubv_500mS = 0;
						gu8v_RfIdCopyLedDisStep++;
						if(gu8v_RfIdCopyLedDisStep>2) gu8v_RfIdCopyLedDisStep = 0;
					}
				}
				else
				{
					if(!WorkModeFlag.byte)
					{
						gu8v_DisplayBuf[C_LED_KEY_ADD] |= C_SEG_DP;
						switch(gu8v_JiaoTiMode)
						{
							case 1:
								gu8v_DisplayBuf[C_LED_NUM2_ADD] |= C_SEG_DP;//led10 18M
							break;
							case 2:
								gu8v_DisplayBuf[C_LED_NUM1_ADD] |= C_SEG_DP;//led11 24M
							break;
							default:
								gu8v_DisplayBuf[C_LED_NUM3_ADD] |= C_SEG_DP;//led9 12M
							break;
						}
					}
				}
		break;
	}
	AIP650_InitPort();
	AIP650_Start();
	AIP650_SendCMD(C_CommandDisplayOn_7);		//È«ÁÁ
	AIP650_End();
	for(length=0;length<4;length++)
	{
		AIP650_Start();
		switch(length)
		{
			case 0:
				AIP650_SendByte(C_CommandDIG0);
			break;
			case 1:
				AIP650_SendByte(C_CommandDIG1);
			break;
			case 2:
				AIP650_SendByte(C_CommandDIG2);
			break;
			case 3:
				AIP650_SendByte(C_CommandDIG3);
			break;
		}
		AIP650_SendByte(gu8v_DisplayBuf[length]);
	}
	AIP650_End();
}
